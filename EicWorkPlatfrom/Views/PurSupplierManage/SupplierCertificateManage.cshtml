
<div class="panel panel-primary" ng-controller="buildQualifiedSupplierInventoryCtrl">
    <div class="panel-heading">
        <h6 class="panel-title">供应商证书管理</h6>
    </div>
    <div class="panel-body" id="editWindow">
        <form class="form-inline" role="search">
            @*<input type="text" class="form-control" ng-model="vmManager.searchYear" placeholder="请输入四位年份 如：2016" />*@
            <span yl-month-button data-title-visible="true" data-yearmonth="vmManager.searchYear"></span>
            <button type="button" class="btn btn-default" ng-click="vmManager.getPurQualifiedSupplier()"><i class="fa fa-search"></i> 载入</button>
            <a class="btn btn-success" href="@Url.Action("CreateQualifiedSupplierInfoList", "PurSupplierManage")"><i class="fa fa-file-excel-o"></i> 导出Excel</a>
        </form>
        <div class="h-split"></div>
        <div class="well" cg-busy="{promise:searchPromise}">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr class="info">
                            <th>供应商信息</th>
                            <th>地址</th>
                            <th>联系人员</th>
                            <th>采购时间</th>
                            <th>供应商类型</th>
                            <th>备注</th>
                            <th>操作(<i class="fa fa-pencil-square-o"></i>)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="item in vmManager.datasets track by $index">
                            <td>
                                <span class="label label-default" title="供应商编号">{{item.SupplierId}}</span>
                                <span class="label label-primary" title="供应商简称">{{item.SupplierShortName}}</span>
                                <span class="label label-primary" title="采购类别">{{item.PurchaseType}}</span>

                                <div class="h-split"></div>
                                <span title="供应商全称">{{item.SupplierName}}</span><br />
                                <div class="h-split"></div>
                                <span title="供应商邮箱" ng-show="item.SupplierEmail">{{item.SupplierEmail}}</span><br />
                                <div class="h-split"></div>
                                <span title="供应商电话">{{item.SupplierTel}}</span>|
                                <span title="供应商传真">{{item.SupplierFaxNo}}</span>
                            </td>

                            <td>
                                <span title="供应商地址">{{item.SupplierAddress}}</span><br />
                                <div class="h-split"></div>
                                <span title="交货地址">{{item.BillAddress}}</span>
                            </td>

                            <td>
                                <span title="供应商联系人">{{item.SupplierUser}}</span><br />
                                <div class="h-split"></div>
                                <span title="常用电话">{{item.SupplierTel}}</span>
                            </td>

                            <td>
                                <span title="上次采购时间">{{item.UpperPurchaseDate}}</span><br />
                                <div class="h-split"></div>
                                <span title="最近采购时间">{{item.LastPurchaseDate}}</span>
                            </td>
                            <td>{{item.SupplierProperty}}</td>
                            <td>{{item.Remark}}</td>
                            <td>
                                <button class="btn btn-xs btn-primary" ng-click="vmManager.goToEdit(item)" title="编辑">
                                    编辑证书
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div yl-pagination
                     data-datasource="vmManager.datasource"
                     data-dataset="vmManager.datasets">
                </div>
            </div>
        </div>

        <div pageslide ps-open="vmManager.editWindowShow" ps-side="left" ps-size="100%" ps-speed="0.25" ps-container='editWindow'>
            <div style="padding:10px;overflow-y:scroll;max-height:480px;">
                <div class="row">
                    <div class="col-md-4">
                        <table class="table table-bordered table-condensed">
                            <thead>
                                <tr class="info"><td>证书列表</td></tr>
                            </thead>
                            <tbody cg-busy="{promise:searchCertificatePromise}">
                                <tr ng-repeat="item in editManager.certificateDatas track by $index">
                                    <td>
                                        {{item.CertificateFileName}}
                                        <span class="btn btn-danger btn-xs pull-right" ng-click="editManager.removeCertificateFile(item)"><i class="fa fa-remove"></i></span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="col-md-8">
                        <form role="form" name="formPurchase" novalidate class="form-horizontal">
                            <fieldset>
                                <legend>
                                    <label>类别信息</label>
                                    <span class="label label-primary pull-right">供应商编号：【{{vm.SupplierId}}】</span>
                                </legend>
                                <div class="form-group">
                                    <label for="purchaseType" class="col-md-2 control-label">采购类别</label>
                                    <div class="col-md-4">
                                        <input name="purchaseType" class="form-control" ng-model="vm.PurchaseType" ng-show="true" required />
                                        <div class="error-messages" ng-messages="formPurchase.purchaseType.$error" ng-show="operate.showValidation">
                                            <small ng-message="required">采购类别不能为空</small>
                                        </div>
                                    </div>

                                    <label for="supplierProperty" class="col-md-2 control-label">供应商类别</label>
                                    <div class="col-md-4">
                                        <input name="supplierProperty" class="form-control" ng-model="vm.SupplierProperty" ng-show="true" required />
                                        <div class="error-messages" ng-messages="formPurchase.supplierProperty.$error" ng-show="operate.showValidation">
                                            <small ng-message="required">供应商类别不能为空</small>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                            <fieldset>
                                <legend>
                                    <label>证书信息</label>
                                </legend>
                                <div class="form-group" ng-repeat="fileItem in editManager.fileList track by $index">
                                    <div class="col-md-3">
                                        <input type="text" name="eligibleCertificate" class="form-control" ng-model="fileItem.EligibleCertificate" placeholder="输入证书名称" />
                                        <div class="error-messages" ng-messages="formPurchase.eligibleCertificate.$error" ng-show="operate.showValidation">
                                            <small ng-message="required">证书名称不能为空</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <input type="date" name="dateOfCertificate" class="form-control" ng-model="fileItem.DateOfCertificate" placeholder="获取证书日期" />
                                        <div class="error-messages" ng-messages="formPurchase.dateOfCertificate.$error" ng-show="operate.showValidation">
                                            <small ng-message="required">证书日期不能为空</small>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <div class="input-group-addon">
                                                <label for="drawing">文件名称：</label>
                                            </div>
                                            <input type="file" name="file" class="form-control" onchange="angular.element(this).scope().selectFile(this)" ng-click="editManager.getFile(fileItem)" />
                                            <div class="input-group-addon" cg-busy="{promise:uploadPromise}">
                                                <span class="label label-primary" ng-click="editManager.addFile(fileItem)" ng-show="fileItem.adding">
                                                    <i class="fa fa-plus-square"></i>
                                                </span>
                                                <span class="label label-success" ng-show="fileItem.uploadSuccess">
                                                    <i class="fa fa-check-square"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>

                            <hr />
                            <div class="alert alert-info">
                                <div class="row">
                                    <div class="col-md-1">
                                    </div>
                                    <div class="col-md-10">
                                        <button class="btn btn-primary" ng-click="operate.savePurSupplierCertificateDatas(formPurchase.$valid)"><i class="fa fa-save"></i>保存</button>
                                        <button class="btn btn-default" ng-click="operate.cancel()"><i class="fa fa-refresh"></i>取消</button>
                                        <span yl-operatemsg-board></span>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
