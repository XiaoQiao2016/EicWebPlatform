<div class="panel panel-primary" ng-controller="dReportInputCtrl">
    <div class="panel-heading">
        <h6 class="panel-title">生产日报录入</h6>
    </div>
    <div class="panel-body">
        <div cg-busy="{promise:promise}">
            <button class="btn btn-sm btn-warning" title="载入模板" ng-click="vmManager.getReportInputDataTemplate()"><i class="fa fa-download"></i>载入模板</button>
            <button type="button" class="btn btn-sm btn-default" ng-model="vmManager.inputMode"
                    data-html="1" data-multiple="0" ng-change="vmManager.selectInputMode()"
                    data-animation="am-flip-x" data-placeholder="普通编辑"
                    bs-options="item.id as item.text for item in vmManager.inputModes" bs-select>
                <span class="caret"></span>
            </button>
             部门<label class="label label-default">{{vmManager.department}}</label>
            <button class="btn btn-sm btn-default"
                    data-title="选择部门名称"
                    data-template-url="@Url.Action("TreeSelectTpl", "CommonTpl")"
                    data-animation="am-flip-x" data-auto-close="1"
                    data-bs-popover>
                <i class="fa fa-sitemap"></i>
            </button>
            <label>录入日期</label>
            <input type="date" ng-model="vmManager.InputDate"/>
            <span>
                <button class="btn btn-sm btn-primary" title="新增" ng-click="vmManager.showDReportInputView()"><i class="fa fa-pencil"></i>新增</button>
                <button class="btn btn-sm btn-success" title="保存" ng-click="operate.save()"><i class="fa fa-save"></i>保存</button>
                <span class="pull-right">
                    <button type="button" class="btn btn-sm btn-primary" 
                            data-animation="am-flip-x"
                            bs-dropdown aria-haspopup="true" aria-expanded="false">
                        <span class="fa fa-desktop">看板工具</span>
                    </button>
                    <span class="dropdown-menu" role="menu">
                        <span class="list-group">
                            <a href="#" class="list-group-item" ng-click="vmManager.showProFlowView()" title="工序汇总看板"><i class="fa fa-th-large"></i>工序汇总</a>
                            <a href="#" class="list-group-item" ng-click="vmManager.showPersonView()" title="人员汇总看板"><i class="fa fa-th-list"></i>人员汇总</a>
                            <a href="#" class="list-group-item" ng-click="vmManager.showOrderIdView()" title="工单汇总看板"><i class="fa fa-list-ol"></i>工单汇总</a>
                        </span>
                    </span>
                    <button class="btn btn-sm btn-warning" title="审核确认" ng-click="operate.audit()"><i class="fa fa-paperclip"></i>审核确认</button>
                </span>
            </span>
            <div class="h-split"></div>
            <span yl-operatemsg-board></span>
        </div>
        <div class="bs-callout bs-callout-info" style="min-height:475px;" id="editWindow">
            <div class="table-responsive" style="min-height:470px;max-height:475px;overflow-y:auto">
                <table class=" table table-bordered table-condensed table-hover" style="table-layout:fixed;">
                <colgroup>
                    <col width="110" />
                    <col width="140" ng-show="tbl.colVisible" />
                    <col width="160" ng-show="tbl.colVisible" />
                </colgroup>
                <colgroup>
                    <col width="130" />
                    <col width="110" ng-show="tbl.colVisible" />
                </colgroup>
                <colgroup>
                    <col width="110" />
                    <col width="110" />
                    <col width="80" ng-show="tbl.colVisible" />
                </colgroup>
                <colgroup>
                    <col width="40" />
                </colgroup>
                <colgroup>
                    <col width="90" />
                    <col width="90" />
                    <col width="90" />
                </colgroup>
                <colgroup>
                    <col width="90" />
                    <col width="90" />
                    <col width="90" />
                    <col width="90" />
                    <col width="90" />
                </colgroup>
                <thead>
                    <tr>
                        <th class="text-center" colspan="{{tbl.orderIdColSpan}}">工单信息</th>

                        <th class="text-center" colspan="{{tbl.proFlowColSpan}}">机台/工艺</th>

                        <th class="text-center" colspan="{{tbl.workerColSpan}}">人员</th>

                        <th class="text-center"><i class="fa fa-pencil-square-o"></i></th>

                        <th class="text-center" colspan="{{tbl.productColSpan}}">产量</th>

                        <th class="text-center" colspan="{{tbl.workHoursColSpan}}">工时</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>

                        <td class="text-center info"><span>工单号</span></td>
                        <td class="text-center info" ng-show="tbl.colVisible"><span>品名</span></td>
                        <td class="text-center info" ng-show="tbl.colVisible"><span>规格</span></td>

                        <td class="text-center info">
                            <span>机台*工艺</span>
                        </td>
                        <td class=" text-center info" ng-show="tbl.colVisible">
                            <span>标准工时</span>
                        </td>

                        <td class="text-center info"><span>作业员</span></td>
                        <td class="text-center info"><span>师傅</span></td>
                        <td ng-show="tbl.colVisible" class="text-center info"><span>班别</span></td>


                        <td class="text-center info"><i class="fa fa-flag"></i></td>


                        <td class="text-center info"><span>产量</span></td>
                        <td class="text-center info"><span>不良数</span></td>
                        <td class="text-center info" ng-show="tbl.colVisible"><span>良品数</span></td>

                        <td ng-show="tbl.colVisible" class="text-center info"><span>设置时数</span></td>
                        <td class="text-center info"><span>投入工时</span></td>
                        <td class="text-center info"><span>出勤时数</span></td>
                        <td class="text-center info"><span>生产时数</span></td>
                        <td class="text-center info"><span>非生产时数</span></td>
                    </tr>

                    <tr ng-repeat="item in vmManager.editDatas track by $index" ng-dblclick="vmManager.editRow(item)">
                        @*工单信息*@
                        <td>
                            <span ng-hide="item.editting">{{item.OrderId}}</span>
                            <input ng-model="vm.OrderId" focus-if="focus.orderIdFocus" focus-setter style="width:100px;"
                                   ng-keydown="vmManager.getWorkOrderInfo($event)" placeholder="工单单号" ng-show="item.editting" />
                        </td>

                        <td class="text-center" ng-show="tbl.colVisible" cg-busy="{promise:searchPromise}">{{item.ProductName}}</td>
                        <td class="text-center" ng-show="tbl.colVisible">{{item.ProductSpecification}}</td>

                        @*工艺、机台*@
                        <td>
                            <span ng-hide="item.editting">{{item.ProductFlowName}}</span>
                            <div class="input-group">
                                <input ng-model="vm.ProductFlowID" focus-if="focus.productFlowFocus" focus-setter style="width:100px;"
                                       ng-keydown="vmManager.getProductFlowInfo($event)" placeholder="工艺/机台编号" ng-show="item.editting" />
                                <div class="input-group-btn" ng-show="item.editting">
                                    <button type="button" class="btn btn-xs btn-primary"
                                            data-animation="am-flip-x"
                                            bs-dropdown aria-haspopup="true" aria-expanded="false">
                                        <span class="fa fa-chevron-circle-down"></span>
                                    </button>
                                    <div class="dropdown-menu" role="menu">
                                        <div class="list-group">
                                            <a href="#" ng-repeat="flow in vmManager.productFlows track by $index" 
                                               class="list-group-item" ng-click="vmManager.selectProductFlow(flow)">
                                                <span>{{flow.ProductFlowName}}</span>
                                                <span class="badge">{{flow.ProductFlowId}}</span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                        </td>
                        <td class=" text-center" ng-show="tbl.colVisible">{{item.StandardHours}}</td>

                        @*人员信息*@
                        <td>
                            <span ng-hide="item.editting">{{item.UserName}}</span>
                            
                            <div class="input-group" ng-show="item.editting">
                                <input ng-model="vm.UserWorkerId" ng-keydown="vmManager.getWorkerInfo($event,'worker')"
                                       focus-if="focus.workerIdFocus" focus-setter data-ensure-user-exist style="width:100px;"
                                       placeholder="工号或姓名" />
                                <div class="input-group-btn" ng-hide="vmManager.isSingle">
                                    <button type="button" class="btn btn-xs btn-primary"
                                            data-animation="am-flip-x"
                                            bs-dropdown aria-haspopup="true" aria-expanded="false">
                                        <span class="fa fa-chevron-circle-down"></span>
                                    </button>
                                    <div class="dropdown-menu" role="menu">
                                        <div class="list-group">
                                            <a href="#" class="list-group-item" style="cursor:pointer" ng-click="vmManager.selectWorker(worker,'worker')"
                                                ng-repeat="worker in vmManager.searchedWorkers track by $index" data-title="岗位：{{worker.Post}}" data-bs-tooltip>
                                                <i class="fa fa-user"></i>
                                                <span class="label label-default">{{worker.WorkerId}}</span>
                                                <span class="label label-primary">{{worker.Name}}</span>|
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div ng-hide="item.editting">
                                <span ng-show="item.isMachineMode">{{item.MasterName}}</span>
                                <span ng-hide="item.isMachineMode">--</span>
                            </div>
                            <div ng-show="item.editting">
                                <span ng-hide="item.isMachineMode">--</span>
                                <div class="input-group" ng-show="item.editting">
                                    <input ng-model="vm.MasterWorkerId" ng-keydown="vmManager.getWorkerInfo($event,'master')"
                                           focus-if="focus.masterWorkerIdFocus" focus-setter style="width:100px;"
                                           placeholder="工号或姓名" ng-show="item.isMachineMode" />
                                    <div class="input-group-btn" ng-hide="vmManager.isSingle">
                                        <button type="button" class="btn btn-xs btn-primary"
                                                data-animation="am-flip-x"
                                                bs-dropdown aria-haspopup="true" aria-expanded="false">
                                            <span class="fa fa-chevron-circle-down"></span>
                                        </button>
                                        <div class="dropdown-menu" role="menu">
                                            <div class="list-group">
                                                <a href="#" class="list-group-item" style="cursor:pointer" ng-click="vmManager.selectWorker(worker,'master')"
                                                    ng-repeat="worker in vmManager.searchedWorkers track by $index" data-title="岗位：{{worker.Post}}" data-bs-tooltip>
                                                    <i class="fa fa-user"></i>
                                                    <span class="label label-default">{{worker.WorkerId}}</span>
                                                    <span class="label label-primary">{{worker.Name}}</span>|
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td ng-show="tbl.colVisible" class="text-center">{{item.ClassType}}</td>
                        @*工具按钮*@
                        <td class="text-center">
                            <button type="button" class="btn btn-xs btn-primary" ng-show="item.editting"
                                    data-animation="am-flip-x"
                                    bs-dropdown aria-haspopup="true" aria-expanded="false">
                                <span class="fa fa-pencil-square"></span>
                            </button>
                            <div class="dropdown-menu" role="menu">
                                <div class="list-group">
                                    <a href="#" class="list-group-item" ng-click="vmManager.editOver(item)" title="结束编辑"><i class="fa fa-check-square"></i>结束</a>
                                    <a href="#" class="list-group-item" ng-click="vmManager.removeRow(item)" title="删除此行"><i class="fa fa-remove"></i>删除</a>
                                </div>
                            </div>

                            <button type="button" class="btn btn-xs btn-success" ng-hide="item.editting"
                                    data-animation="am-flip-x"
                                    bs-dropdown aria-haspopup="true" aria-expanded="false">
                                <span class="fa fa-indent"></span>
                            </button>
                            <div class="dropdown-menu" role="menu">
                                <div class="list-group">
                                    <a href="#" class="list-group-item" ng-click="vmManager.editProductHoursRow(item)" title="编辑产量工时信息"><i class="fa fa-sign-out"></i>编辑</a>
                                    <a href="#" class="list-group-item" ng-click="vmManager.copyAndPaste(item)" title="复制并粘贴行"><i class="fa fa-clipboard"></i>复制并粘贴</a>
                                    <a href="#" class="list-group-item" ng-click="vmManager.cancelEdit(item)" title="取消编辑行"><i class="fa fa-undo"></i>取消</a>
                                </div>
                            </div>
                        </td>

                        @*产量信息*@
                        <td>
                            <span ng-hide="item.pheditting">{{item.Qty}}</span>
                            <input ng-model="vm.Qty" ng-keydown="vmManager.inputQty($event)"
                                   focus-if="focus.qtyFocus" focus-setter style="width:80px;"
                                   placeholder="总产量" ng-show="item.pheditting" />
                        </td>
                        <td>
                            <span ng-hide="item.pheditting">{{item.QtyBad}}</span>
                            <input ng-model="vm.QtyBad" ng-keydown="vmManager.inputQtyBad($event,item)"
                                   focus-if="focus.qtyBadFocus" focus-setter style="width:80px;"
                                   placeholder="不良品数" ng-show="item.pheditting" />
                        </td>
                        <td ng-show="tbl.colVisible" class="text-center">{{item.QtyGood}}</td>
                        @*工时信息*@
                        <td ng-show="tbl.colVisible">{{item.SetHours}}</td>
                        <td>
                            <span ng-hide="item.pheditting">{{item.InputHours}}</span>
                            <input ng-model="vm.InputHours" ng-keydown="vmManager.inputHours($event)"
                                   focus-if="focus.inputHoursFocus" focus-setter style="width:80px;"
                                   placeholder="投入工时" ng-show="item.pheditting" />
                        </td>
                        <td>
                            <span ng-hide="item.pheditting">{{item.ProductionHours}}</span>
                            <input ng-model="vm.ProductionHours" ng-keydown="vmManager.inputProductionHours($event)"
                                   focus-if="focus.productHoursFoucs" focus-setter style="width:80px;"
                                   placeholder="生产时数" ng-show="item.pheditting" />
                        </td>
                        <td>
                            <span ng-hide="item.pheditting">{{item.AttendanceHours}}</span>
                            <input ng-model="vm.AttendanceHours" ng-keydown="vmManager.inputAttendanceHours($event)"
                                   focus-if="focus.attendanceHoursFoucs" focus-setter style="width:80px;"
                                   placeholder="出勤时数" ng-show="item.pheditting" />
                        </td>
                        <td>
                            <span ng-hide="item.pheditting">{{item.NonProductionHours}}</span>
                            <input ng-model="vm.NonProductionHours" ng-keydown="vmManager.inputNonProductionHours($event,item)"
                                   focus-if="focus.nonProductHoursFocus" focus-setter style="width:80px;"
                                   placeholder="非生产时数" ng-show="item.pheditting" />
                        </td>
                    </tr>
                </tbody>
                </table>
            </div>
        </div>

        <div pageslide ps-open="vmManager.dReportPreviewDisplay" ps-side="bottom" ps-size="{{vmManager.boardViewSize}}" p ps-speed="0.25" ps-container='editWindow'>
            <div style="padding:10px;overflow-y:auto">

            </div>
        </div>
        <div pageslide ps-open="vmManager.proFlowBoardDisplay" ps-side="bottom" ps-size="{{vmManager.boardViewSize}}" p ps-speed="0.25" ps-container='editWindow'>
            <div style="padding:10px;overflow-y:auto">

            </div>
        </div>
        <div pageslide ps-open="vmManager.personBoardDisplay" ps-side="bottom" ps-size="{{vmManager.boardViewSize}}" p ps-speed="0.25" ps-container='editWindow'>
            <div style="padding:10px;overflow-y:auto">

            </div>
        </div>
        <div pageslide ps-open="vmManager.orderIdBoardDisplay" ps-side="bottom" ps-size="{{vmManager.boardViewSize}}" p ps-speed="0.25" ps-container='editWindow'>
            <div style="padding:10px;overflow-y:auto">

            </div>
        </div>
    </div>

    <div class="panel-footer">

    </div>
</div>