<div class="panel panel-default" ng-controller="reportImproveProblemCtrl">
    <div bs-tabs bs-active-pane="vmManager.activeTab" cg-busy="promise:searchPromise">
        <div bs-pane data-title="上报问题登记" data-name="initTab">
            <div class="row">
                <div class="col-md-8">
                    <form role="form" name="formReport" novalidate class="form-horizontal" onkeypress="if (event.keyCode === 13) return false;">
                        <div class="bs-callout bs-callout-info">
                            <fieldset>
                                <legend><a class="label label-success" data-toggle="collapse" data-parent="#div1" href="#collapseOne">提报人信息:</a>
                                <i class="glyphicon glyphicon-flag"></i><a class="label label-danger" ng-bind="vm.WorkerId"></a>
                              <i class="glyphicon glyphicon-user"></i><a class="label label-success"ng-bind="vm.Name"></a>
                                <i class="glyphicon glyphicon-home"></i><a class="label label-primary"ng-bind="vm.Department"></a>

                                </legend>
                                <div id="collapseOne" class="panel-collapse collapse ">
                                    <div class="panel-body">
                                        <div class="form-group">
                                            <label for="workerId" class="col-md-2 control-label">工号</label>
                                            <div class="col-md-4">
                                                <div class="input-group">
                                                    <input name="workerId" class="form-control" ng-model="vm.WorkerId" placeholder="请输入您工号" ng-change="vmManager.getWorkerInfo()" data-ensure-user-exist required />
                                                    <div class="error-messages" ng-messages="fromReport.workerId.$error" ng-show="operate.showValidation">
                                                        <small ng-message="required">工号不能为空</small>
                                                    </div>
                                                    <div class="input-group-addon" ng-show="vmManager.isSingle">
                                                        <label class="label label-primary"> <i class="fa fa-user"></i> {{vm.Name}}</label>
                                                    </div>
                                                    <div class="input-group-btn" ng-hide="vmManager.isSingle">
                                                        <button type="button" class="btn btn-primary"
                                                                data-animation="am-flip-x"
                                                                bs-dropdown aria-haspopup="true" aria-expanded="false">
                                                            <span class="fa fa-chevron-circle-down"></span>
                                                        </button>
                                                        <div class="dropdown-menu" role="menu">
                                                            <ul class="list-group">
                                                                <li class="list-group-item" style="cursor:pointer" ng-click="vmManager.selectWorker(worker)"
                                                                    ng-repeat="worker in vmManager.searchedWorkers track by $index" data-title="岗位：{{worker.Post}}" data-bs-tooltip>
                                                                    <i class="fa fa-user"></i>
                                                                    <span class="label label-primary">工号：{{worker.WorkerId}}</span>|
                                                                    <span>姓名：{{worker.Name}}</span>|
                                                                    <span>部门：{{worker.Department}}</span>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <label for="name" class="col-md-2 control-label">姓名</label>
                                            <div class="col-md-4">
                                                <input type="text" name="name" class="form-control" ng-model="vm.Name" placeholder="姓名" readonly required />
                                                <div class="error-messages" ng-messages="formReport.name.$error" ng-show="operate.showValidation">
                                                    <small ng-message="required">姓名不能为空</small>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="department" class="col-md-2 control-label">部门</label>
                                            <div class="col-md-4">
                                                <div class="input-group">
                                                    <input name="department" class="form-control" ng-model="vm.Department" readonly required />
                                                    <div class="error-messages" ng-messages="formReport.department.$error" ng-show="operate.showValidation">
                                                        <small ng-message="required">部门不能为空</small>
                                                    </div>
                                                    @*<span class="input-group-btn">
                                                        <button class="btn btn-primary"
                                                                data-title="请选择部门"
                                                                data-template-url="@Url.Action("TreeSelectTpl", "CommonTpl")"
                                                                data-animation="am-flip-x" data-auto-close="1"
                                                                data-bs-popover>
                                                            <i class="fa fa-sitemap"></i>
                                                        </button>
                                                    </span>*@
                                                </div>
                                            </div>
                                            <label for="problemDate" class="col-md-2 control-label">提报日期</label>
                                            <div class="col-md-4">
                                                <input type="date" name="problemDate" class="form-control" ng-model="vm.ProblemDate" placeholder="提报日期" format-date required />
                                                <div class="error-messages" ng-messages="formReport.problemDate.$error" ng-show="operate.showValidation">
                                                    <small ng-message="required">提报日期不能为空</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>                       
                                <br />
                                <legend ><a class="label label-success"  data-toggle="collapse"data-parent="#div2" href="#collapseTwo">问题描述信息<i class="glyphicon glyphicon-sort"></i></a></legend>
                                <div id="collapseTwo" class="panel-collapse collapse in">
                                    <div class="panel-body">
                                        <div class="form-group">
                                            <label for="caseId" class="col-md-2 control-label">编号</label>
                                            <div class="col-md-4">
                                                <input name="caseId" class="form-control" ng-model="vm.CaseId" placeholder="编号自动生成" readonly required />
                                                <div class="error-messages" ng-messages="formReport.caseId.$error" ng-show="operate.showValidation">
                                                    <small ng-message="required">编号不能为空</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="systemName" class="col-md-2 control-label">系统名称</label>
                                            <div class="col-md-4">
                                                <div class="input-group">
                                                    <input name="systemName" placeholder="请选择系统名称" class="form-control" ng-model="vm.SystemName" required />
                                                    <div class="error-messages" ng-messages="formReport.systemName.$error" ng-show="operate.showValidation">
                                                        <small ng-message="required">系统名称不能为空</small>
                                                    </div>
                                                    <span class="input-group-btn">

                                                        <button type="button" class="btn btn-primary" ng-model="vm.SystemName" ng-change="vmManager.selectSystemName()"
                                                                data-html="1" data-ng-multiple="0" data-animation="am-flip-x" data-placeholder="选择系统名称"
                                                                data-bs-options="item.id as item.text for item in vmManager.systemNames" data-bs-select></button>
                                                    </span>
                                                </div>
                                            </div>
                                            <label for="moduleName" class="col-md-2 control-label">模块类别</label>
                                            <div class="col-md-4">
                                                <div class="input-group">
                                                    <input name="moduleName" class="form-control" placeholder="请选择模块类别" ng-model="vm.ModuleName" required />
                                                    <div class="error-messages" ng-messages="formReport.moduleName.$error" ng-show="operate.showValidation">
                                                        <small ng-message="required">模块类别不能为空</small>
                                                    </div>
                                                    <span class="input-group-btn">
                                                        <button type="button" class="btn btn-primary" ng-model="vm.ModuleName"
                                                                data-html="1" data-ng-multiple="0" data-animation="am-flip-x" data-placeholder="选择模块类别" ng-change="vmManager.autoCreateCaseid()"
                                                                data-bs-options="module.id as module.text for module in vmManager.showmoduleNameList" data-bs-select></button>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="problemDesc" class="col-md-2 control-label">问题描述</label>
                                            <div class="col-md-10">
                                                <textarea rows="8" name="problemDesc" class="form-control" ng-model="vm.ProblemDesc" placeholder="问题描述" />


                                            </div>
                                            <div class="error-messages" ng-messages="formReport.problemDesc.$error" ng-show="operate.showValidation">
                                                <small ng-message="required">问题描述不能为空</small>
                                            </div>
                                            <div class="col-md-3 col-md-offset-2">
                                                <div yl-upload-file></div>
                                                <div ng-if="vmManager.isdisabled">{{vm.FileName}}</div>

                                            </div>

                                        </div>

                                        <div class="form-group">
                                            <label for="problemDegree" class="col-md-2 control-label">问题性质</label>
                                            <div class="col-md-4">
                                                <div class="input-group">
                                                    <input name="problemDegree" class="form-control" placeholder="请选择性质" ng-model="vm.ProblemDegree" required />
                                                    <div class="error-messages" ng-messages="formReport.problemDegree.$error" ng-show="operate.showValidation">
                                                        <small ng-message="required">问题性质不能为空</small>
                                                    </div>
                                                    <span class="input-group-btn">
                                                        <button type="button" class="btn btn-primary" ng-model="vm.ProblemDegree"
                                                                data-html="1" data-ng-multiple="0" data-animation="am-flip-x" data-placeholder="选择性质"
                                                                data-bs-options="degree.id as degree.text for degree in vmManager.problemDegrees" data-bs-select></button>
                                                    </span>
                                                </div>
                                            </div>                                      
                                        </div>
                                       
                                      </div>  
                                    <hr/>
                                    <div class="alert alert-info ">
                                        <div class="row">
                                            <div class="col-md-2">
                                            </div>
                                            <div class="col-md-10 col-lg-offset-4">
                                                <button id="btnsave" class="btn btn-primary" ng-click="operate.saveAll(formReport.$valid)"><i class="fa fa-save"></i>保存</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                <button class="btn btn-primary" ng-click="operate.refresh()"><i class="fa fa-undo"></i>重置</button>
                                                <span yl-operatemsg-board></span>
                                            </div>
                                        </div>
                                    </div>
                                    </div>                                                      
                            </fieldset>
                        </div>
                    </form>
                </div>
                <div class="col-md-4">
                    <form for="form" class="form-inline">
                        <div class="form-group" style="background-color:lightblue">
                            <label for="inputDate">当前状态:</label>
                            <div class="input-group">
                                <input id="currentproblemsolve" type="text" class="form-control" ng-model="query.problemSolve" placeholder="请选择状态" ng-show="false" />
                                <button type="button" class="btn btn-default" ng-model="query.problemSolve"
                                        data-html="1" data-multiple="0" data-animation="am-flip-x" data-placeholder="选择当前进度..."
                                        data-bs-options="proStatus.value as proStatus.label for proStatus in vmManager.problemSolves track by $index" data-bs-select>
                                    <span class="caret"></span>
                                </button>
                            </div>
                        </div>
                        <button id="currentqueryproblemsolve" role="button" class="btn btn-primary" ng-click="vmManager.getReportImproveProblemData(1)">
                            <i class="fa fa-search"></i>

                        </button>
                        <div class="h-split"></div>
                        <div class="well" cg-busy="{promise:searchPromise}">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover " style="table-layout:fixed;">
                                    <colgroup>
                                        <col width="60" />
                                        <col width="100" />
                                        <col width="50" />
                                    </colgroup>
                                    <thead>
                                        <tr class="danger">

                                            <th>编号</th>

                                            <th>模块类别</th>

                                            <th>操作(<i class="fa fa-pencil-square-o"></i>)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="item in vmManager.searchDataset track by $index">

                                            <td ng-bind="item.CaseId"></td>

                                            <td ng-bind="item.ModuleName"></td>

                                            <td>
                                                <button id="checkProblemSole" class="btn btn-xs btn-danger" ng-bind="item.ProblemSolve" ng-click="operate.handleItem(item)"><i class="fa fa-edit"></i></button>
                                                <button id="edit" class="btn btn-xs btn-primary" ng-click="operate.editItem(item)" title="修改"><i class="fa fa-pencil-square-o"></i>修改</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div ng-if="vmManager.datasource.length>0"
                                     yl-pagination
                                     data-dataset="vmManager.searchDataset"
                                     data-datasource="vmManager.datasource">
                                </div>

                            </div>

                        </div>
                    </form>
                    <dialog id="dialog1" ng-if="dialog.open" modal data-close="dialog.close()" style="width:65%">
                        <content dialog-title>
                            <i class="fa fa-pencil-square">数据窗口</i>
                        </content>

                        <content dialog-content style="width:100%">
                            <form role="form" name="formReport" novalidate class="form-horizontal" onkeypress="if (event.keyCode === 13) return false;">
                                <div class="bs-callout bs-callout-info">
                                    <div class="form-group">
                                        <label for="problemDegree" class="col-md-2 control-label">问题性质</label>
                                        <div class="col-md-4">
                                            <div class="input-group">
                                                <input name="problemDegree" class="form-control" ng-model="vm.ProblemDegree" readonly required />
                                            </div>
                                        </div>
                                        <label for="caseId" class="col-md-2 control-label">编号</label>
                                        <div class="col-md-4">
                                            <input name="caseId" class="form-control" ng-model="vm.CaseId" placeholder="编号自动生成" readonly required />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="systemName" class="col-md-2 control-label">系统名称</label>
                                        <div class="col-md-4">
                                            <div class="input-group">
                                                <input name="systemName" placeholder="请选择系统名称" class="form-control" ng-model="vm.SystemName" readonly required />

                                            </div>
                                        </div>
                                        <label for="moduleName" class="col-md-2 control-label">模块类别</label>
                                        <div class="col-md-4">
                                            <div class="input-group">
                                                <input name="moduleName" class="form-control" ng-model="vm.ModuleName" readonly required />
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="problemDesc" class="col-md-2 control-label">问题描述</label>
                                        <div class="col-md-10">
                                            <textarea rows="6" name="problemDesc" class="form-control" ng-model="vm.ProblemDesc" readonly />
                                          
                                            <br>
                                            <label for="fileName" class="control-label">附件</label>
                                            <a href="~/FileLibrary/ReportProblemHandleDataFile/{{vm.FileName}}" class="control-label label label-danger"target="_blank">{{vm.FileName}}</a>
                                        </div>

                                    </div>
                                    <div class="form-group">
                                        <label for="problemSolveMethod" class="col-md-2 control-label">解决方法</label>
                                        <div class="col-md-10">
                                            <textarea rows="4" name="problemSolveMethod" class="form-control" ng-model="vm.ProblemSolveMethod" required></textarea>
                                        </div>
                                        <div class="error-messages" ng-messages="formReport.problemSolveMethod.$error" ng-show="operate.showValidation">
                                            <small ng-message="required">解决方法不能为空</small>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="problemSolve" class="col-md-2 control-label">处理结果</label>
                                        <div class="col-md-4">
                                            <div class="input-group">
                                                <input type="text" name="problemSolve" ng-model="vm.ProblemSolve" ng-show="false" required />
                                                <div class="error-messages" ng-messages="formReport.problemSolve.$error" ng-show="operate.showValidation">
                                                    <small ng-message="required">处理结果不能为空</small>
                                                </div>

                                                <button type="button" class="btn btn-default" ng-model="vm.ProblemSolve"
                                                        data-html="1" data-multiple="0" data-animation="am-flip-x" data-placeholder="选择处理结果..."
                                                        data-bs-options="proStatus.value as proStatus.label for proStatus in vmManager.problemSolves track by $index" data-bs-select></button>

                                            </div>
                                        </div>


                                        <label for="problemProcess" class="col-md-2 control-label">执行人</label>
                                        <div class="col-md-4">
                                            <div class="input-group">
                                                <input name="problemProcess" class="form-control" ng-model="vm.ProblemProcess" required />
                                                <div class="error-messages" ng-messages="formReport.problemProcess.$error" ng-show="operate.showValidation">
                                                    <small ng-message="required">执行人不能为空</small>
                                                </div>
                                                <span class="input-group-btn">
                                                    <button type="button" class="btn btn-primary" ng-model="vm.ProblemProcess"
                                                            data-html="1" data-multiple="0" data-placeholder="选择执行人" data-animation="am-flip-x"
                                                            data-bs-options="person.name as person.text for person in vmManager.problemProcesss" data-bs-select></button>
                                                </span>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="h-split" />
                                    <div class="alert alert-info ">
                                        <div class="row">
                                            <div class="col-md-2">
                                            </div>
                                            <div class="col-md-10">
                                                <button id="btnsave" class="btn btn-primary" ng-click="operate.saveAll(formReport.$valid)"><i class="fa fa-save"></i>保存</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                <button class="btn btn-primary" ng-click="operate.refresh()"><i class="fa fa-undo"></i>重置</button>
                                                <span yl-operatemsg-board></span>
                                            </div>
                                        </div>
                                    </div>



                                </div>
                            </form>

                        </content>
                    </dialog>
                </div>
            </div>
        </div>

        <div bs-pane data-title="上报问题查询" data-name="editTab">
            <div bs-tabs>
                <div bs-pane data-title="处理状态">
                    <form class="form-inline" novalidate>
                        <div class="form-group">
                            <label for="inputDate">处理状态:</label>
                            <div class="input-group">
                                <input id="txtproblemsolve" type="text" class="form-control" ng-model="query.problemSolve" placeholder="请选择状态" ng-show="false" />
                                <button type="button" class="btn btn-default" ng-model="query.problemSolve"
                                        data-html="1" data-multiple="0" data-animation="am-flip-x" data-placeholder="选择当前进度..."
                                        data-bs-options="proStatus.value as proStatus.label for proStatus in vmManager.problemSolves track by $index" data-bs-select>
                                    <span class="caret"></span>
                                </button>
                            </div>
                        </div>
                        <button id="btnproblemsolve" role="button" class="btn btn-primary" ng-click="vmManager.getReportImproveProblemData(1)"><i class="fa fa-search"></i>查询</button>
                    </form>
                </div>
                <div class="h-split"></div>
                <div class="well" cg-busy="{promise:searchPromise}">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover table-bordered" style="table-layout:fixed;">
                            <colgroup>
                                <col width="60" />
                                <col width="100" />
                                <col width="160" />
                                <col width="200" />
                                <col width="200" />
                                <col width="120" />
                                <col width="100" />
                                <col width="100" />
                                <col width="100" />
                                <col width="100" />
                                <col width="120" />
                                <col width="100" />
                            </colgroup>
                            <thead>
                                <tr class="info">
                                    <th>项次</th>
                                    <th>编号</th>
                                    <th>系统名称</th>
                                    <th>模块类别</th>
                                    <th>问题描述</th>
                                    <th>附件名</th>
                                    <th>问题性质</th>
                                    <th>提报时期</th>
                                    <th>问题状态</th>
                                    <th>提报人</th>
                                    <th>部门</th>
                                    <th>操作(<i class="fa fa-pencil-square-o"></i>)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="item in vmManager.searchDataset">
                                    <td ng-bind="$index"></td>
                                    <td ng-bind="item.CaseId"></td>
                                    <td ng-bind="item.SystemName"></td>
                                    <td ng-bind="item.ModuleName"></td>
                                    <td ng-bind="item.ProblemDesc"></td>
                                    <td ng-bind="item.FileName"></td>
                                    <td ng-bind="item.ProblemDegree"></td>
                                    <td ng-bind="item.ProblemDate"></td>
                                    <td ng-bind="item.ProblemSolve"></td>
                                    <td ng-bind="item.Name"></td>
                                    <td ng-bind="item.Department"></td>
                                    <td>
                                        @*<button class="btn btn-xs btn-primary" ng-click="operate.editItem(item)" title="修改"><i class="fa fa-edit"></i>{{item.ProblemSolve}}</button>*@
                                        <button class="btn btn-xs btn-primary" ng-click="  operate.handleItem(item)" title="明细"><i class="fa fa-check"></i>明细</button>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div ng-if="vmManager.datasource.length>0"
                             yl-pagination
                             data-dataset="vmManager.searchDataset"
                             data-datasource="vmManager.datasource">
                        </div>
                    </div>
                </div>

            </div>


        </div>
    </div>

</div>